<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Teachable Machine Thunkable</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
<script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"></script>
</head>

<body>
<div id="status">Inizializzazione...</div>
<span id="messageDisplay"></span>

<script>
const BASE_URL = "https://teachablemachine.withgoogle.com/models/Otp8GlSUe/";
let model = null;

/* ===============================
   INVIO MESSAGGI A THUNKABLE
================================ */
function sendToThunkable(message) {
  ThunkableWebviewerExtension.postMessage(message);
}

/* ===============================
   INIT MODELLO
================================ */
async function init() {
  try {
    const modelURL = BASE_URL + "model.json";
    const metadataURL = BASE_URL + "metadata.json";
    model = await tmImage.load(modelURL, metadataURL);
    document.getElementById("status").innerText = "Modello pronto";
  sendToThunkable("PRONTO");
  } catch (e) {
    //sendToThunkable("ERRORE_LOAD:" + e.message);
  }
}
init();

/* ===============================
   RICEZIONE URL + PREDIZIONE
================================ */
    ThunkableWebviewerExtension.receiveMessageWithReturnValue(function(message, callback) {
      // Create the response by prefixing the received message with "demo: "
      const response = 'demo: ' + message;
      sendToThunkable("io:"+message);
      // Optionally display the received message on the webpage
      document.getElementById('messageDisplay').innerText = response;
       
      // Send the response back to the Thunkable app
	  
      callback(response);
    });
</script>
</body>
</html>
