<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
const MODEL_URL = "https://teachablemachine.withgoogle.com/models/Otp8GlSUe/";

let model;

/* 1️⃣ Caricamento modello */
async function loadModel() {
  const modelURL = MODEL_URL + "model.json";
  const metadataURL = MODEL_URL + "metadata.json";
  model = await tmImage.load(modelURL, metadataURL);
}

/* 2️⃣ Predizione da URL immagine */
async function predictFromUrl(imageUrl) {
  if (!model) {
    await loadModel();
  }

  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = imageUrl;

    img.onload = async () => {
      const predictions = await model.predict(img);

      // JSON PULITO
      const result = predictions.map(p => ({
        className: p.className,
        probability: Number(p.probability.toFixed(4))
      }));

      resolve(result);
    };

    img.onerror = () => reject("Errore caricamento immagine");
  });
}

/* 3️⃣ ESEMPIO DI USO */
(async () => {
  const imageUrl = "https://tuo-dominio.com/immagine.jpg";
  const json = await predictFromUrl(imageUrl);
  console.log(JSON.stringify(json));
})();
</script>
